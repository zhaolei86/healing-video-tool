<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>治愈视频创作工具</title>
  <style>
    body {
      font-family: "Segoe UI", "Microsoft YaHei", sans-serif;
      background: linear-gradient(135deg, #d8e3f2, #f6d4eb);
      padding: 2em;
      color: #333;
    }
    .container {
      max-width: 900px;
      margin: 0 auto;
      background: white;
      padding: 2em;
      border-radius: 12px;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
    }
    textarea, input {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      font-size: 1rem;
    }
    button {
      margin-top: 1em;
      padding: 10px 20px;
      font-size: 1rem;
      background: #667eea;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    h2 {
      color: #444;
    }
    .section { margin-top: 2em; }
    pre { background: #f0f0f0; padding: 1em; white-space: pre-wrap; }
  </style>
</head>
<body>
  <div class="container">
    <h2>治愈视频创作工具</h2>

    <div class="section">
      <label for="idea">请输入你的视频创意或灵感描述：</label>
      <textarea id="idea" rows="4" placeholder="例如：雨天的下午，一杯热茶和一本旧书"></textarea>
      <button onclick="generateAll()">开始生成内容</button>
    </div>

    <div class="section">
      <h3>关键词提取</h3>
      <pre id="keywords"></pre>
    </div>

    <div class="section">
      <h3>文案生成</h3>
      <pre id="copywriting"></pre>
    </div>

    <div class="section">
      <h3>图片与视频素材（Pixabay）</h3>
      <div id="media"></div>
    </div>

    <div class="section">
      <h3>背景音乐与环境音推荐</h3>
      <pre id="music"></pre>
    </div>

    <div class="section">
      <h3>剪辑结构建议</h3>
      <pre id="editTips"></pre>
    </div>

    <div class="section">
      <button onclick="exportProject()">导出 OpenShot 工程文件</button>
      <div id="exportStatus"></div>
    </div>
  </div>

  <script>
    async function generateAll() {
      const idea = document.getElementById('idea').value.trim();
      if (!idea) return alert('请输入创作灵感');

      const deepSeekKey = 'sk-2ea29790547549a9ac24ac4450290112';
      const pixabayKey = '50457136-be49db6f26c1db2a62f3940fe';

      document.getElementById('keywords').textContent = '正在提取关键词...';
      document.getElementById('copywriting').textContent = '正在生成文案...';
      document.getElementById('editTips').textContent = '正在生成剪辑建议...';
      document.getElementById('music').textContent = '正在推荐音乐...';

      try {
        const response = await fetch('https://api.deepseek.com/v1/chat/completions', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${deepSeekKey}`
          },
          body: JSON.stringify({
            model: 'deepseek-chat',
            messages: [
              { role: 'system', content: '你是一个治愈系短视频创作者助手，请根据用户的灵感提供关键词、文案、剪辑建议和音乐关键词。' },
              { role: 'user', content: `描述是：${idea}` }
            ]
          })
        });
        const data = await response.json();
        const result = data.choices[0].message.content;

        const keywordsMatch = result.match(/关键词[\s：:]*([\s\S]*?)\n/);
        const copyMatch = result.match(/文案[\s：:]*([\s\S]*?)\n(剪辑|音乐|$)/);
        const editMatch = result.match(/剪辑建议[\s：:]*([\s\S]*?)\n(音乐|$)/);
        const musicMatch = result.match(/音乐关键词[\s：:]*([\s\S]*)/);

        const keywords = keywordsMatch ? keywordsMatch[1].trim() : '';
        const copywriting = copyMatch ? copyMatch[1].trim() : '';
        const editTips = editMatch ? editMatch[1].trim() : '';
        const musicWords = musicMatch ? musicMatch[1].trim() : '';

        document.getElementById('keywords').textContent = keywords;
        document.getElementById('copywriting').textContent = copywriting;
        document.getElementById('editTips').textContent = editTips;
        document.getElementById('music').textContent = `建议音乐关键词：${musicWords}\n你可以在 FreeMusicArchive、SoundJay 等网站手动搜索这些关键词获取音乐。`;

        searchPixabay(keywords, pixabayKey);
      } catch (e) {
        alert('生成失败，请检查网络或 API 密钥');
        console.error(e);
      }
    }

    async function searchPixabay(keywords, apiKey) {
      const container = document.getElementById('media');
      container.innerHTML = '正在加载素材...';

      const query = encodeURIComponent(keywords);
      const imgUrl = `https://pixabay.com/api/?key=${apiKey}&q=${query}&image_type=photo&per_page=5`;
      const vidUrl = `https://pixabay.com/api/videos/?key=${apiKey}&q=${query}&per_page=3`;

      try {
        const [imgRes, vidRes] = await Promise.all([fetch(imgUrl), fetch(vidUrl)]);
        const imgData = await imgRes.json();
        const vidData = await vidRes.json();

        let html = '<h4>图片：</h4>';
        imgData.hits.forEach(img => {
          html += `<div><img src="${img.previewURL}" alt="" style="width:200px;"><br><a href="${img.largeImageURL}" download>下载图片</a></div>`;
        });
        html += '<h4>视频：</h4>';
        vidData.hits.forEach(v => {
          html += `<div><video src="${v.videos.medium.url}" controls width="300"></video><br><a href="${v.videos.medium.url}" download>下载视频</a></div>`;
        });

        container.innerHTML = html;
      } catch (e) {
        container.innerHTML = '素材加载失败';
      }
    }

    function exportProject() {
      document.getElementById('exportStatus').textContent = '（此功能仅限演示，需本地脚本支持生成 .osp 文件）';
    }
  </script>
</body>
</html>
