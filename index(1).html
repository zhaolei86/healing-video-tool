<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>æ²»æ„ˆè§†é¢‘åˆ›ä½œå·¥å…· - æœ€ç»ˆå®Œæ•´ç‰ˆ</title>
  <style>
    body { font-family: "Segoe UI", "Microsoft YaHei", sans-serif; background: linear-gradient(135deg, #d8e3f2, #f6d4eb); padding: 2em; color: #333; }
    .container { max-width: 900px; margin: 0 auto; background: white; padding: 2em; border-radius: 12px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
    textarea, input { width: 100%; padding: 10px; margin-top: 5px; font-size: 1rem; }
    button { margin-top: 1em; padding: 10px 20px; font-size: 1rem; background: #667eea; color: white; border: none; border-radius: 6px; cursor: pointer; }
    h2 { color: #444; }
    .section { margin-top: 2em; }
    pre { background: #f0f0f0; padding: 1em; white-space: pre-wrap; }
  </style>
</head>
<body>
  <div class="container">
    <h2>æ²»æ„ˆè§†é¢‘åˆ›ä½œå·¥å…· - å®Œæ•´ç‰ˆ</h2>

    <div class="section">
      <label for="idea">è¯·è¾“å…¥ä½ çš„è§†é¢‘åˆ›æ„æˆ–çµæ„Ÿæè¿°ï¼š</label>
      <textarea id="idea" rows="4" placeholder="ä¾‹å¦‚ï¼šé›¨å¤©çš„ä¸‹åˆï¼Œä¸€æ¯çƒ­èŒ¶å’Œä¸€æœ¬æ—§ä¹¦"></textarea>
      <button onclick="generateAll()">å¼€å§‹ç”Ÿæˆå†…å®¹</button>
    </div>

    <div class="section">
      <h3>å…³é”®è¯æå–</h3>
      <pre id="keywords"></pre>
    </div>

    <div class="section">
      <h3>æ–‡æ¡ˆç”Ÿæˆ</h3>
      <pre id="copywriting"></pre>
    </div>

    <div class="section">
      <h3>å›¾ç‰‡ä¸è§†é¢‘ç´ æï¼ˆPixabayï¼‰</h3>
      <button onclick="refreshPixabay()">ğŸ”„ åˆ·æ–°ç´ æ</button>
      <div id="media"></div>
    </div>

    <div class="section">
      <h3>èƒŒæ™¯éŸ³ä¹ä¸ç¯å¢ƒéŸ³æ¨è</h3>
      <pre id="music"></pre>
    </div>

    <div class="section">
      <h3>å‰ªè¾‘ç»“æ„å»ºè®®</h3>
      <pre id="editTips"></pre>
    </div>
  </div>

  <script>
    let currentKeyword = '';
    let currentPage = 1;

    async function generateAll() {
      const idea = document.getElementById('idea').value.trim();
      if (!idea) return alert('è¯·è¾“å…¥åˆ›ä½œçµæ„Ÿ');

      const deepSeekKey = 'sk-2ea29790547549a9ac24ac4450290112';
      const pixabayKey = '50457136-be49db6f26c1db2a62f3940fe';

      document.getElementById('keywords').textContent = 'æ­£åœ¨æå–å…³é”®è¯...';
      document.getElementById('copywriting').textContent = 'æ­£åœ¨ç”Ÿæˆæ–‡æ¡ˆ...';
      document.getElementById('editTips').textContent = 'æ­£åœ¨ç”Ÿæˆå‰ªè¾‘å»ºè®®...';
      document.getElementById('music').textContent = 'æ­£åœ¨æ¨èéŸ³ä¹...';

      try {
        const response = await fetch('https://api.deepseek.com/v1/chat/completions', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${deepSeekKey}`
          },
          body: JSON.stringify({
            model: 'deepseek-chat',
            messages: [
              { role: 'system', content: 'ä½ æ˜¯ä¸€ä¸ªæ²»æ„ˆç³»çŸ­è§†é¢‘åˆ›ä½œè€…åŠ©æ‰‹ï¼Œè¯·æ ¹æ®ç”¨æˆ·çš„çµæ„Ÿæä¾›å…³é”®è¯ã€æ–‡æ¡ˆã€å‰ªè¾‘å»ºè®®å’ŒéŸ³ä¹å…³é”®è¯ã€‚è¾“å‡ºæ ¼å¼ä¸ºï¼šå…³é”®è¯ï¼š...\næ–‡æ¡ˆï¼š...\nå‰ªè¾‘å»ºè®®ï¼š...\néŸ³ä¹å…³é”®è¯ï¼š...' },
              { role: 'user', content: `æè¿°æ˜¯ï¼š${idea}` }
            ]
          })
        });

        const data = await response.json();
        const result = data.choices[0].message.content;

        const keywordsMatch = result.match(/å…³é”®è¯[\sï¼š:]*([\s\S]*?)\n/);
        const copyMatch = result.match(/æ–‡æ¡ˆ[\sï¼š:]*([\s\S]*?)\nå‰ªè¾‘å»ºè®®/);
        const editMatch = result.match(/å‰ªè¾‘å»ºè®®[\sï¼š:]*([\s\S]*?)\néŸ³ä¹å…³é”®è¯/);
        const musicMatch = result.match(/éŸ³ä¹å…³é”®è¯[\sï¼š:]*([\s\S]*)/);

        const keywords = keywordsMatch ? keywordsMatch[1].trim() : '';
        const copywriting = copyMatch ? copyMatch[1].trim() : '';
        const editTips = editMatch ? editMatch[1].trim() : '';
        const musicWords = musicMatch ? musicMatch[1].trim() : '';

        currentKeyword = keywords;
        currentPage = 1;

        document.getElementById('keywords').textContent = keywords;
        document.getElementById('copywriting').textContent = copywriting;
        document.getElementById('editTips').textContent = editTips;
        document.getElementById('music').textContent = `å»ºè®®éŸ³ä¹å…³é”®è¯ï¼š${musicWords}\nä½ å¯ä»¥åœ¨ FreeMusicArchiveã€SoundJay ç­‰ç½‘ç«™æ‰‹åŠ¨æœç´¢è¿™äº›å…³é”®è¯è·å–éŸ³ä¹ã€‚`;

        searchPixabay(currentKeyword, currentPage);
      } catch (e) {
        alert('ç”Ÿæˆå¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œæˆ– API å¯†é’¥');
        console.error(e);
      }
    }

    async function searchPixabay(keywords, page = 1) {
      const container = document.getElementById('media');
      container.innerHTML = 'æ­£åœ¨åŠ è½½ç´ æ...';

      const apiKey = '50457136-be49db6f26c1db2a62f3940fe';
      const query = encodeURIComponent(keywords);
      const imgUrl = `https://pixabay.com/api/?key=${apiKey}&q=${query}&image_type=photo&per_page=4&page=${page}`;
      const vidUrl = `https://pixabay.com/api/videos/?key=${apiKey}&q=${query}&per_page=3&page=${page}`;

      try {
        const [imgRes, vidRes] = await Promise.all([fetch(imgUrl), fetch(vidUrl)]);
        const imgData = await imgRes.json();
        const vidData = await vidRes.json();

        let html = '<h4>å›¾ç‰‡ï¼š</h4>';
        imgData.hits.forEach(img => {
          html += `<div><img src="${img.previewURL}" alt="" style="width:200px;"><br><a href="${img.largeImageURL}" download>ä¸‹è½½å›¾ç‰‡</a></div>`;
        });
        html += '<h4>è§†é¢‘ï¼š</h4>';
        vidData.hits.forEach(v => {
          html += `<div><video src="${v.videos.medium.url}" controls width="300"></video><br><a href="${v.videos.medium.url}" download>ä¸‹è½½è§†é¢‘</a></div>`;
        });

        container.innerHTML = html;
      } catch (e) {
        container.innerHTML = 'ç´ æåŠ è½½å¤±è´¥';
      }
    }

    function refreshPixabay() {
      if (!currentKeyword) return alert('è¯·å…ˆç”Ÿæˆå…³é”®è¯');
      currentPage += 1;
      searchPixabay(currentKeyword, currentPage);
    }
  </script>
</body>
</html>
