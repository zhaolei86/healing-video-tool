
<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>æ²»æ„ˆè§†é¢‘åˆ›ä½œå·¥å…· - å®Œæ•´ç‰ˆå«å¯¼å‡º</title>
</head>
<body>
  <h2>æ²»æ„ˆè§†é¢‘åˆ›ä½œå·¥å…·ï¼ˆå®Œæ•´ç‰ˆï¼‰</h2>
  <textarea id="idea" rows="4" placeholder="è¾“å…¥åˆ›ä½œçµæ„Ÿ..."></textarea>
  <button onclick="generateAll()">å¼€å§‹ç”Ÿæˆå†…å®¹</button>

  <h3>å…³é”®è¯</h3>
  <pre id="keywords"></pre>

  <h3>æ–‡æ¡ˆ</h3>
  <pre id="copywriting"></pre>

  <h3>å›¾ç‰‡ä¸è§†é¢‘ç´ æ</h3>
  <button onclick="refreshPixabay()">ğŸ”„ åˆ·æ–°ç´ æ</button>
  <div id="media"></div>

  <h3>èƒŒæ™¯éŸ³ä¹ä¸ç¯å¢ƒéŸ³æ¨è</h3>
  <pre id="music"></pre>

  <h3>å‰ªè¾‘å»ºè®®</h3>
  <pre id="editTips"></pre>

  <h3>å¯¼å‡ºå·¥ç¨‹</h3>
  <button onclick="exportOSP()">ğŸ“¦ å¯¼å‡º OpenShot å·¥ç¨‹æ–‡ä»¶</button>
  <div id="exportStatus"></div>

  <script>
    let currentKeyword = '';
    let currentPage = 1;
    let currentMedia = [];

    async function generateAll() {
      const idea = document.getElementById('idea').value.trim();
      if (!idea) return alert('è¯·è¾“å…¥åˆ›ä½œçµæ„Ÿ');

      document.getElementById('keywords').textContent = 'æå–ä¸­...';
      document.getElementById('copywriting').textContent = 'ç”Ÿæˆä¸­...';
      document.getElementById('editTips').textContent = 'ç”Ÿæˆä¸­...';
      document.getElementById('music').textContent = 'æ¨èä¸­...';

      const deepSeekKey = 'sk-2ea29790547549a9ac24ac4450290112';

      try {
        const response = await fetch('https://api.deepseek.com/v1/chat/completions', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${deepSeekKey}`
          },
          body: JSON.stringify({
            model: 'deepseek-chat',
            messages: [
              { role: 'system', content: 'ä½ æ˜¯ä¸€ä¸ªè§†é¢‘åˆ›ä½œåŠ©æ‰‹ï¼Œå¸®æˆ‘æå–å…³é”®è¯ã€ç”Ÿæˆæ–‡æ¡ˆã€éŸ³ä¹å»ºè®®ã€å‰ªè¾‘å»ºè®®ã€‚è¾“å‡ºæ ¼å¼å¦‚ä¸‹ï¼šå…³é”®è¯ï¼š...\næ–‡æ¡ˆï¼š...\nå‰ªè¾‘å»ºè®®ï¼š...\néŸ³ä¹å…³é”®è¯ï¼š...' },
              { role: 'user', content: idea }
            ]
          })
        });

        const result = (await response.json()).choices[0].message.content;

        const kw = result.match(/å…³é”®è¯[\sï¼š:]*([\s\S]*?)\n/);
        const txt = result.match(/æ–‡æ¡ˆ[\sï¼š:]*([\s\S]*?)\nå‰ªè¾‘/);
        const cut = result.match(/å‰ªè¾‘å»ºè®®[\sï¼š:]*([\s\S]*?)\néŸ³ä¹/);
        const mus = result.match(/éŸ³ä¹å…³é”®è¯[\sï¼š:]*([\s\S]*)/);

        currentKeyword = kw ? kw[1].trim() : '';
        document.getElementById('keywords').textContent = currentKeyword;
        document.getElementById('copywriting').textContent = txt ? txt[1].trim() : '';
        document.getElementById('editTips').textContent = cut ? cut[1].trim() : '';
        document.getElementById('music').textContent = mus ? mus[1].trim() : '';

        currentPage = 1;
        searchPixabay(currentKeyword, currentPage);
      } catch (err) {
        alert("å†…å®¹ç”Ÿæˆå¤±è´¥");
        console.error(err);
      }
    }

    async function searchPixabay(keyword, page) {
      const key = '50457136-be49db6f26c1db2a62f3940fe';
      const imgUrl = `https://pixabay.com/api/?key=${key}&q=${encodeURIComponent(keyword)}&image_type=photo&per_page=3&page=${page}`;
      const vidUrl = `https://pixabay.com/api/videos/?key=${key}&q=${encodeURIComponent(keyword)}&per_page=2&page=${page}`;
      const media = document.getElementById('media');
      currentMedia = [];

      media.innerHTML = 'åŠ è½½ä¸­...';

      try {
        const [imgRes, vidRes] = await Promise.all([fetch(imgUrl), fetch(vidUrl)]);
        const imgs = await imgRes.json();
        const vids = await vidRes.json();

        let html = '<h4>å›¾ç‰‡ï¼š</h4>';
        imgs.hits.forEach(i => {
          html += `<img src="${i.previewURL}" width="200"><br><a href="${i.largeImageURL}" download>ä¸‹è½½å›¾ç‰‡</a><br>`;
          currentMedia.push(i.largeImageURL);
        });

        html += '<h4>è§†é¢‘ï¼š</h4>';
        vids.hits.forEach(v => {
          html += `<video src="${v.videos.medium.url}" width="300" controls></video><br><a href="${v.videos.medium.url}" download>ä¸‹è½½è§†é¢‘</a><br>`;
          currentMedia.push(v.videos.medium.url);
        });

        media.innerHTML = html;
      } catch (err) {
        media.innerHTML = 'åŠ è½½å¤±è´¥';
        console.error(err);
      }
    }

    function refreshPixabay() {
      if (!currentKeyword) return alert("è¯·å…ˆç”Ÿæˆå†…å®¹");
      currentPage += 1;
      searchPixabay(currentKeyword, currentPage);
    }

    function exportOSP() {
      const template = {
        version: "2.0",
        title: "æ²»æ„ˆç³»è§†é¢‘é¡¹ç›®",
        tracks: currentMedia.map((url, i) => ({
          type: "video",
          file: url,
          start: i * 5,
          length: 5,
          track: 0
        }))
      };
      const blob = new Blob([JSON.stringify(template, null, 2)], { type: 'application/json' });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = "healing_project.osp";
      link.click();
      document.getElementById("exportStatus").textContent = "âœ… å·²å¯¼å‡º .osp æ–‡ä»¶";
    }
  </script>
</body>
</html>
